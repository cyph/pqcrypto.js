//
// Supersingular Isogeny Key Encapsulation Ref. Library
//
// InfoSec Global Inc., 2017-2020
// Basil Hess <basil.hess@infosecglobal.com>
//

#include <sike_params.h>
#include <stdlib.h>

const sike_params_raw_t SIKEp434 = {
  .name = "SIKEp434",

  .p	  = "0x2341F271773446CFC5FD681C520567BC65C783158AEA3FDC1767AE2FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF",

  .lA   = "2",
  .eA   = "216",
  .lB   = "3",
  .eB   = "137",

  .A = 6,
  .B = 1,

  .xQA0	= "0xC7461738340EFCF09CE388F666EB38F7F3AFD42DC0B664D9F461F31AA2EDC6B4AB71BD42F4D7C058E13F64B237EF7DDD2ABC0DEB0C6C",
  .xQA1	= "0x25DE37157F50D75D320DD0682AB4A67E471586FBC2D31AA32E6957FA2B2614C4CD40A1E27283EAAF4272AE517847197432E2D61C85F5",
  .yQA0	= "0x1D407B70B01E4AEE172EDF491F4EF32144F03F5E054CEF9FDE5A35EFA3642A11817905ED0D4F193F31124264924A5F64EFE14B6EC97E5",
  .yQA1	= "0xE7DEC8C32F50A4E735A839DCDB89FE0763A184C525F7B7D0EBC0E84E9D83E9AC53A572A25D19E1464B509D97272AE761657B4765B3D6",
  .xPA0	= "0x3CCFC5E1F050030363E6920A0F7A4C6C71E63DE63A0E6475AF621995705F7C84500CB2BB61E950E19EAB8661D25C4A50ED279646CB48",
  .xPA1	= "0x1AD1C1CAE7840EDDA6D8A924520F60E573D3B9DFAC6D189941CB22326D284A8816CC4249410FE80D68047D823C97D705246F869E3EA50",
  .yPA0	= "0x1AB066B84949582E3F66688452B9255E72A017C45B148D719D9A63CDB7BE6F48C812E33B68161D5AB3A0A36906F04A6A6957E6F4FB2E0",
  .yPA1	= "0xFD87F67EA576CE97FF65BF9F4F7688C4C752DCE9F8BD2B36AD66E04249AAF8337C01E6E4E1A844267BA1A1887B433729E1DD90C7DD2F",
  //.xRA0	= "0xF37AB34BA0CEAD94F43CDC50DE06AD19C67CE4928346E829CB92580DA84D7C36506A2516696BBE3AEB523AD7172A6D239513C5FD2516",
  //.xRA1	= "0x196CA2ED06A657E90A73543F3902C208F410895B49CF84CD89BE9ED6E4EE7E8DF90B05F3FDB8BDFE489D1B3558E987013F9806036C5AC",
  .xQB0	= "0x12E84D7652558E694BF84C1FBDAAF99B83B4266C32EC65B10457BCAF94C63EB063681E8B1E7398C0B241C19B9665FDB9E1406DA3D3846",
  .xQB1	= "0x0",
  .yQB0	= "0x0",
  .yQB1	= "0xEBAAA6C731271673BEECE467FD5ED9CC29AB564BDED7BDEAA86DD1E0FDDF399EDCC9B49C829EF53C7D7A35C3A0745D73C424FB4A5FD2",
  .xPB0	= "0x8664865EA7D816F03B31E223C26D406A2C6CD0C3D667466056AAE85895EC37368BFC009DFAFCB3D97E639F65E9E45F46573B0637B7A9",
  .xPB1	= "0x0",
  .yPB0	= "0x6AE515593E73976091978DFBD70BDA0DD6BCAEEBFDD4FB1E748DDD9ED3FDCF679726C67A3B2CC12B39805B32B612E058A4280764443B",
  .yPB1	= "0x0",
  //.xRB0	= "0x1CD28597256D4FFE7E002E87870752A8F8A64A1CC78B5A2122074783F51B4FDE90E89C48ED91A8F4A0CCBACBFA7F51A89CE518A52B76C",
  //.xRB1	= "0x147073290D78DD0CC8420B1188187D1A49DBFA24F26AAD46B2D9BB547DBB6F63A760ECB0C2B20BE52FB77BD2776C3D14BCBC404736AE4",

  .crypto_bytes = 16,
  .msg_bytes = 16,
};

const sike_params_raw_t SIKEp503 = {
  .name = "SIKEp503",

  .p    = "0x4066F541811E1E6045C6BDDA77A4D01B9BF6C87B7E7DAF13085BDA2211E7A0ABFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF",
  .lA   = "2",
  .eA   = "250",
  .lB   = "3",
  .eB   = "159",

  .A = 6,
  .B = 1,

  .xQA0	= "0x325CF6A8E2C6183A8B9932198039A7F965BA8587B67925D08D809DBF9A69DE1B621F7F134FA2DAB82FF5A2615F92CC71419FFFAAF86A290D604AB167616461",
  .xQA1	= "0x3E7B0494C8E60A8B72308AE09ED34845B34EA0911E356B77A11872CF7FEEFF745D98D0624097BC1AD7CD2ADF7FFC2C1AA5BA3C6684B964FA555A0715E57DB1",
  .yQA0	= "0x3A34654000BD4CB2612017BD5A1965A9F89FE11C55D517DF91B89B94F4F9C58B9A9DD056915573FEDC09CCD4997E82378759E00A2DE225CE04589D201FD754",
  .yQA1	= "0x19DEF0E8930E5123A22E346B1FFBD35EB01451647D8708A4835473B2539BD26806ED105A29F2D3F7EAA262426A965338782C5D20FBF478E4D1C8DBFC5B8294",
  .xPA0	= "0x2ED31A03825FA14BC1D92C503C061D843223E611A92D7C5FBEC0F2C915EE7EEE73374DF6A1161EA00CDCB786155E21FD38220C3772CE670BC68274B851678",
  .xPA1	= "0x1EE4E4E9448FBBAB4B5BAEF280A99B7BF86A1CE05D55BD603C3BA9D7C08FD8DE7968B49A78851FFBC6D0A17CB2FA1B57F3BABEF87720DD9A489B5581F915D2",
  .yPA0	= "0x244D5F814B6253688138E317F24975E596B09BB15C6418E5295AAF73BA7F96EFED145DFAE1B21A8B7B121FEFA1B6E8B52F00478218589E604B97359B8A6E0F",
  .yPA1	= "0x181CCC9F0CBE1390CC14149E8DE88EE79992DA32230DEDB25F04FADE07F242A9057366060CB59927DB6DC8B20E6B15747156E3C5300545E9674487AB393CA7",
  //.xRA0	= "0x3D24CF1F347F1DA54C1696442E6AFC192CEE5E320905E0EAB3C9D3FB595CA26C154F39427A0416A9F36337354CF1E6E5AEDD73DF80C710026D49550AC8CE9F",
  //.xRA1	= "0x6869EA28E4CEE05DCEE8B08ACD59775D03DAA0DC8B094C85156C212C23C72CB2AB2D2D90D46375AA6D66E58E44F8F219431D3006FDED7993F51649C029498",
  .xQB0	= "0x39014A74763076675D24CF3FA28318DAC75BCB04E54ADDC6494693F72EBB7DA7DC6A3BBCD188DAD5BECE9D6BB4ABDD05DB38C5FBE52D985DCAF74422C24D53",
  .xQB1	= "0x0",
  .yQB0	= "0x0",
  .yQB1	= "0x25512012C90A6869C4B29B9A757A03006BC7DF0BF7A2526A0713939FA48018AE3E249BD63699BEB3B8DEA215B7AE1B5A30FE371B64C5F1B0BF051A11D68E04",
  .xPB0	= "0x32D03FD1E99ED0CB05C0707AF74617CBEA5AC6B75905B4B54B1B0C2D73697840155E7B1005EFB02B5D02797A8B66A5D258C76A3C9EF745CECE11E9A178BADF",
  .xPB1	= "0x0",
  .yPB0	= "0x2D810F828E3DC024D1BBBC7D6FA6E302CC5D458571763B7CCD0E4DBC9FA1163F0C1F8F4AE32A57F89DF8D2586D2A06E9FA30442B94A725266358C45236ADF3",
  .yPB1	= "0x0",
  //.xRB0	= "0xC1465FD048FFB8BF2158ED57F0CFFF0C4D5A4397C7542D722567700FDBB8B2825CAB4B725764F5F528294B7F95C17D560E25660AD3D07AB011D95B2CB522",
  //.xRB1	= "0x288165466888BE1E78DB339034E2B8C7BDF0483BFA7AB943DFA05B2D1712317916690F5E713740E7C7D4838296E67357DC34E3460A95C330D5169721981758",

  .crypto_bytes = 24,
  .msg_bytes = 24,
};

const sike_params_raw_t SIKEp610 = {
  .name = "SIKEp610",

  .p    = "0x27BF6A768819010C251E7D88CB255B2FA10C4252A9AE7BF45048FF9ABB1784DE8AA5AB02E6E01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF",
  .lA   = "2",
  .eA   = "305",
  .lB   = "3",
  .eB   = "192",

  .A = 6,
  .B = 1,


  .xQA0	= "0x25DA39EC90CDFB9BC0F772CDA52CB8B5A9F478D7AF8DBBA0AEB3E52432822DD88C38F4E3AEC0746E56149F1FE89707C77F8BA4134568629724F4A8E34B06BFE5C5E66E0867EC38B283798B8A",
  .xQA1	= "0x2250E1959256AE502428338CB4715399551AEC78D8935B2DC73FCDCFBDB1A0118A2D3EF03489BA6F637B1C7FEE7E5F31340A1A537B76B5B736B4CDD284918918E8C986FC02741FB8C98F0A0ED",
  .yQA0	= "0xA4FD5539025C0611E4B1CEC3C36F0D7590C035D3A25AD93022849CCEB3F67E4B1DBE988404290DD8B87B8D5E69ED3B0C5CDBCA248DC9D174CF762012CFE2D725CFD92057F2DBF8B04C7B12CC",
  .yQA1	= "0x201C807BD738624E22B87554A2E053A46A9573BA863D4A9D309533E30B27BF7DD8137F5CE0F79C263D9D050541D69817A839085A76395F879315F6999E3441FC8FB3936DEE1BEF5B4E0E25096",
  .xPA0	= "0x1B368BC6019B46CD802129209B3E65B98BC64A92BC4DB2F9F3AC96B97A1B9C124DF549B528F18BEECB1666D27D47530435E84221272F3A97FB80527D8F8A359F8F1598D365744CA3070A5F26C",
  .xPA1	= "0x1459685DCA7112D1F6030DBC98F2C9CBB41617B6AD913E6523416CCBD8ED9C7841D97DF83092B9B3F2AF00D62E08DAD8FA743CBCCCC1782BE0186A3432D3C97C37CA16873BEDE01F0637C1AA2",
  .yPA0	= "0x1CD75CF512FFA9DF878EF495001A57ABC07FC7CE9BB488BB52DDCD7272D8A4FD17DD258ED3F844C862CF48803B9AC2668C7CB79C396128763B578080C30D14CA7EB709F98E3E682A391FB35A7",
  .yPA1	= "0x2001062A6289E4082CED884029207A1ACDEC525D7BC165A6CFF8BB469A8588950A416DBB924D2D673E3D6C32D232F6E6ADA62B37608F652C0B8628827B304BF1365D8211346207B24EFF09458",
  //.xRA0	= "0x1B36A006D05F9E370D5078CCA54A16845B2BFF737C865368707C0DBBE9F5A62A9B9C79ADF11932A9FA4806210E25C92DB019CC146706DFBC7FA2638ECC4343C1E390426FAA7F2F07FDA163FB5",
  //.xRA1	= "0x183C9ABF2297CA69699357F58FED92553436BBEBA2C3600D89522E7009D19EA5D6C18CFF993AA3AA33923ED93592B0637ED0B33ADF12388AE912BC4AE4749E2DF3C3292994DCF37747518A992",
  .xQB0	= "0x14E647CB19B7EAAAC640A9C26B9C26DB7DEDA8FC9399F4F8CE620D2B2200480F4338755AE16D0E090F15EA1882166836A478C6E161C938E4EB8C2DD779B45FFDD17DCDF158AF48DE126B3A047",
  .xQB1	= "0x0",
  .yQB0	= "0x0",
  .yQB1	= "0xE674067F5EA6DE85545C0A99E9E71E64FABFDC281D1E540FEDA47A56ED3ADCDDE1841083FABC7954B467C71AC6349B04974A7F9B688C5F735632FEB394146B0A080880069D8DA3324EDF795B",
  .xPB0	= "0x1587822E647707ED4313D3BE6A811A694FB201561111838A0816BFB5DEC625D23772DE48A26D78C04EEB26CA4A571C67CE4DC4C620282876B2F2FC2633CA548C3AB0C45CC991417A56F7FEFEB",
  .xPB1	= "0x0",
  .yPB0	= "0x14F295114B69D4769AC06DD07F051AD1114BCB7FA6B6EDE19F840969AFD56FD1F728907D3320A0309462A9444D24FE754666DB2470080951B31C2AC59704ABC7670C3C3A992C3C1629791F30",
  .yPB1	= "0x0",
  //.xRB0	= "0x1DB73BC2DE666D24E59AF5E23B79251BA0D189629EF87E56C38778A448FACE312D08EDFB876C3FD45ECF3746D96E2CADBBA08B1A206C47DDD93137059E34C90E2E42E10F30F6E5F52DED74222",
  //.xRB1	= "0x1B2C30180DAF5D91871555CE8EFEC76A4D521F877B754311228C7180A3E2318B4E7A00341FF99F34E35BF7A1053CA76FD77C0AFAE38E2091862AB4F1DD4C8D9C83DE37ACBA6646EDB4C238B48",

  .crypto_bytes = 24,
  .msg_bytes = 24,
};

const sike_params_raw_t SIKEp751 = {
  .name = "SIKEp751",

  .p    = "0x6FE5D541F71C0E12909F97BADC668562B5045CB25748084E9867D6EBE876DA959B1A13F7CC76E3EC968549F878A8EEAFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF",
  .lA   = "2",
  .eA   = "372",
  .lB   = "3",
  .eB   = "239",

  .A = 6,
  .B = 1,

  .xQA0	= "0x1723D2BFA01A78BF4E39E3A333F8A7E0B415A17F208D3419E7591D59D8ABDB7EE6D2B2DFCB21AC29A40F837983C0F057FD041AD93237704F1597D87F074F682961A38B5489D1019924F8A0EF5E4F1B2E64A7BA536E219F5090F76276290E",
  .xQA1	= "0x2569D7EAFB6C60B244EF49E05B5E23F73C4F44169A7E02405E90CEB680CB0756054AC0E3DCE95E2950334262CC973235C2F87D89500BCD465B078BD0DEBDF322A2F86AEDFDCFEE65C09377EFBA0C5384DD837BEDB710209FBC8DDB8C35C7",
  .yQA0	= "0x35B82D1BD2BA608B42794C4820C56A3D8BBAD28380B8D85A1910E2609A61F7BC0BCA8ED8EF883E7E98C744A0AC85D2893738521B62EB23D1983D2EDCF2AB437108DC048AA853FF9BC791224B121E8FDF1EA5F617E6ED5898663DDED49154",
  .yQA1	= "0xF22306A6963907F16AA38F89C672A4054DB5FD1D26598A3140EA204B10094AE64093142AEB056942494D216A74ED9F51FFC9272D1772151013334EC570B532DB0C083CF39867F63D191029033F942E977B85F69EC738B4C26D3B72E2821",
  .xPA0	= "0x4514F8CC94B140F24874F8B87281FA6004CA5B3637C68AC0C0BDB29838051F385FBBCC300BBB24BFBBF6710D7DC8B29ACB81E429BD1BD5629AD0ECAD7C90622F6BB801D0337EE6BC78A7F12FDCB09DECFAE8BFD643C89C3BAC1D87F8B6FA",
  .xPA1	= "0x158ABF500B5914B3A96CED5FDB37D6DD925F2D6E4F7FEA3CC16E1085754077737EA6F8CC74938D971DA289DCF2435BCAC1897D2627693F9BB167DC01BE34AC494C60B8A0F65A28D7A31EA0D54640653A8099CE5A84E4F0168D818AF02041",
  .yPA0	= "0xBF6E4E7A28E9A6EF66A2F1614AE2A2B5A583C9F2DC6C83F84E2D9E6577F9E22B991D58FB2F89666DC1D40A2C0A3AB876CF8DA8878F12325BF8B0CF92E45AE00627041C891BC96FFBB874FC587E4342F78098258DF2E10A5708A70A0D5A8",
  .yPA1	= "0x1502FB44178D1DF80A53858519CBCF233FE387905BC8F9E4138703C6DB7C82302FBFB7E97153F6001FE9102D2597AC2B300A1C669D1A2803F8D05BA3B1F2ACBF27BC1A127B4A553916D62004FD21633C5AEAAB74833853B4C5C42EB71F7E",
  //.xRA0	= "0x6066E07F3C0D964E8BC963519FAC8397DF477AEA9A067F3BE343BC53C883AF29CCF008E5A30719A29357A8C33EB3600CD078AF1C40ED5792763A4D213EBDE44CC623195C387E0201E7231C529A15AF5AB743EE9E7C9C37AF3051167525BB",
  //.xRA1	= "0x50E30C2C06494249BC4A144EB5F31212BD05A2AF0CB3064C322FC3604FC5F5FE3A08FB3A02B05A48557E15C992254FFC8910B72B8E1328B4893CDCFBFC003878881CE390D909E39F83C5006E0AE979587775443483D13C65B107FADA5165",
  .xQB0	= "0x5BF9544781803CBD7E0EA8B96D934C5CBCA970F9CC327A0A7E4DAD931EC29BAA8A854B8A9FDE5409AF96C5426FA375D99C68E9AE714172D7F04502D45307FA4839F39A28338BBAFD54A461A535408367D5132E6AA0D3DA6973360F8CD0F1",
  .xQB1	= "0x0",
  .yQB0	= "0x0",
  .yQB1	= "0x3351F421FC158472AC2DD8B4DABB5B599456748A5BCC4449398F05ED1AD1414B4EEBBB70FB91383474B712EA4B5BF096092CDDD57C0A090B041022064C3A8DD3D890E7B5AC34A24CEF507955F027CC4CECFDB67739CE89F31FDC5FE43243",
  .xPB0	= "0x605D4697A245C394B98024A5554746DC12FF56D0C6F15D2F48123B6D9C498EEE98E8F7CD6E216E2F1FF7CE0C969CCA29CAA2FAA57174EF985AC0A504260018760E9FDF67467E20C13982FF5B49B8BEAB05F6023AF873F827400E453432FE",
  .xPB1	= "0x0",
  .yPB0	= "0x5634690BFC14C45E2FAA930D62589855E5BDD1435CFFBDF609628FD043B4BF295BB35F7B6D37836F2C59A27BB61ED0FF57FF8093FE6B712133D26502F17CB0D46CDC8CF9BA7664EA2B6C1672A8CA2FF1CE313FEEEF4199FC7F14FE720617",
  .yPB1	= "0x0",
  //.xRB0	= "0x55E5124A05D4809585F67FE9EA1F02A06CD411F38588BB631BF789C3F98D1C3325843BB53D9B011D8BD1F682C0E4D8A5E723364364E40DAD1B7A476716AC7D1BA705CCDD680BFD4FE4739CC21A9A59ED544B82566BF633E8950186A79FE3",
  //.xRB1	= "0x5AC57EAFD6CC7569E8B53A148721953262C5B404C143380ADCC184B6C21F0CAFE095B7E9C79CA88791F9A72F1B2F3121829B2622515B694A16875ED637F421B539E66F2FEF1CE8DCEFC8AEA608055E9C44077266AB64611BF851BA06C821",

  .crypto_bytes = 32,
  .msg_bytes = 32,
};

void
sike_setup_params(const sike_params_raw_t *raw, sike_params_t *params) {
  // Base curve -> Coefficients are null
  mont_curve_int_t* EA = &params->EA;
  mont_curve_int_t* EB = &params->EB;

  params->eA = (unsigned long) strtol(raw->eA, NULL, 0);
  params->eB = (unsigned long) strtol(raw->eB, NULL, 0);

  params->lA = (unsigned long) strtol(raw->lA, NULL, 0);
  params->lB = (unsigned long) strtol(raw->lB, NULL, 0);

  ff_Params* ffpA = malloc(sizeof(ff_Params));
  ff_Params* ffpB = malloc(sizeof(ff_Params));


  set_gmp_fp_params(ffpA);
  set_gmp_fp_params(ffpB);

  EA->ffData = ffpA;

  fp_Init(ffpA, params->p);
  fp_ImportHex(raw->p, params->p);

  fp_Init(ffpA, params->ordA);

  mp_pow(params->lA, params->eA, params->ordA);
  params->msbA = mp_sizeinbase(params->ordA, 2);

  fp_Init(ffpA,  EA->ffData->mod);

  fp_Init(ffpA, EA->P.x.x0);
  fp_Init(ffpA, EA->P.x.x1);
  fp_Init(ffpA, EA->P.y.x0);
  fp_Init(ffpA, EA->P.y.x1);
  fp_Init(ffpA, EA->Q.x.x0);
  fp_Init(ffpA, EA->Q.x.x1);
  fp_Init(ffpA, EA->Q.y.x0);
  fp_Init(ffpA, EA->Q.y.x1);

  fp_ImportHex(raw->p,    EA->ffData->mod);


  fp_ImportHex(raw->xPA0, EA->P.x.x0);
  fp_ImportHex(raw->xPA1, EA->P.x.x1);
  fp_ImportHex(raw->yPA0, EA->P.y.x0);
  fp_ImportHex(raw->yPA1, EA->P.y.x1);
  fp_ImportHex(raw->xQA0, EA->Q.x.x0);
  fp_ImportHex(raw->xQA1, EA->Q.x.x1);
  fp_ImportHex(raw->yQA0, EA->Q.y.x0);
  fp_ImportHex(raw->yQA1, EA->Q.y.x1);

  fp2_Init_set(ffpA, &EA->a, raw->A, 0);
  fp2_Init_set(ffpB, &EA->b, raw->B, 0);

  EB->ffData = ffpB;

  fp_Init(ffpB, params->ordB);

  mp_pow(params->lB, params->eB, params->ordB);
  params->msbB = mp_sizeinbase(params->ordB, 2);

  fp_Init(ffpB, EB->ffData->mod);

  fp_Init(ffpB, EB->P.x.x0);
  fp_Init(ffpB, EB->P.x.x1);
  fp_Init(ffpB, EB->P.y.x0);
  fp_Init(ffpB, EB->P.y.x1);
  fp_Init(ffpB, EB->Q.x.x0);
  fp_Init(ffpB, EB->Q.x.x1);
  fp_Init(ffpB, EB->Q.y.x0);
  fp_Init(ffpB, EB->Q.y.x1);

  fp_ImportHex(raw->p,    EB->ffData->mod);

  fp_ImportHex(raw->xPB0, EB->P.x.x0);
  fp_ImportHex(raw->xPB1, EB->P.x.x1);
  fp_ImportHex(raw->yPB0, EB->P.y.x0);
  fp_ImportHex(raw->yPB1, EB->P.y.x1);
  fp_ImportHex(raw->xQB0, EB->Q.x.x0);
  fp_ImportHex(raw->xQB1, EB->Q.x.x1);
  fp_ImportHex(raw->yQB0, EB->Q.y.x0);
  fp_ImportHex(raw->yQB1, EB->Q.y.x1);

  fp2_Init_set(ffpB, &EB->a, raw->A, 0);
  fp2_Init_set(ffpB, &EB->b, raw->B, 0);

  params->crypto_bytes = raw->crypto_bytes;
  params->msg_bytes = raw->msg_bytes;
}

void
sike_teardown_params(sike_params_t *params) {

  mont_curve_int_t* EA = &params->EA;
  mont_curve_int_t* EB = &params->EB;

  ff_Params* ffpA = EA->ffData;
  ff_Params* ffpB = EB->ffData;

  fp_Clear(ffpA, params->p);

  fp_Clear(ffpA,  EA->ffData->mod);
  fp_Clear(ffpA,  params->ordA);

  fp_Clear(ffpA, EA->P.x.x0);
  fp_Clear(ffpA, EA->P.x.x1);
  fp_Clear(ffpA, EA->P.y.x0);
  fp_Clear(ffpA, EA->P.y.x1);
  fp_Clear(ffpA, EA->Q.x.x0);
  fp_Clear(ffpA, EA->Q.x.x1);
  fp_Clear(ffpA, EA->Q.y.x0);
  fp_Clear(ffpA, EA->Q.y.x1);

  fp2_Clear(ffpA, &EA->a);
  fp2_Clear(ffpB, &EA->b);

  fp_Clear(ffpB, EB->ffData->mod);
  fp_Clear(ffpB, params->ordB);

  fp_Clear(ffpB, EB->P.x.x0);
  fp_Clear(ffpB, EB->P.x.x1);
  fp_Clear(ffpB, EB->P.y.x0);
  fp_Clear(ffpB, EB->P.y.x1);
  fp_Clear(ffpB, EB->Q.x.x0);
  fp_Clear(ffpB, EB->Q.x.x1);
  fp_Clear(ffpB, EB->Q.y.x0);
  fp_Clear(ffpB, EB->Q.y.x1);

  fp2_Clear(ffpB, &EB->a);
  fp2_Clear(ffpB, &EB->b);

  free(ffpA);
  free(ffpB);
}